# How HTTPS Works?

> *Notes from the comic [howhttps.works](https://howhttps.works/) by [DNS Simple](https://dnsimple.com/comics)*

## Why do we need HTTPS?
  
* **Privacy** – means no one can eavesdrop on your messages. (The padlock on the URL bar)
  * Example: Someone getting your username/password while sigining in to a website.

* **Integrity** – means that the message is not manipulated on the way to its destination. (Avoiding *man-in-the-middle* attack)
  * Example: Someone intercepting your messages and modifying them before they reach to their intented destination.

* **Identification** – means that the site I am visiting is indeed the the one I think it is.
  * HTTPS, via SSL certificates, ensures you are connected exactly with the receiver you would expect.
  * This SSL certificate is valid and issued by a legitimate Certificate Authority.

## Encryption – The Keys

HTTPS needs a way to provide privacy, integrity, and identification on the web. And this mechanism is called *"encryption"*.

There are 2 types of encryption algorithm:

1. **Symmetric Key Algorithm**

    * There is only 1 key to encrypt & decrypt a message.
    
    * Before sending the message the browser uses this key to encrypt the message and the reciver on the other side uses the same key to decrypt it.
    
    * Encryption is just a process by which the through a series of steps, the message is transformed. Each time obfuscating it furthur.
    
    * To decrypt the message, you follow the same steps in reverse.
    
    * The encryption key is mixed in with the message, so even if you know the encryption algorithm, without the key, the message is still nonsense.
    
    * The problem with this approach is, there is only 1 key and it must be kept secret, and must be shared privatly and securly.

2. **Asymmetric Keys**

    * There are 2 keys, one public and other private – both are paired to work together.
    
    * The message is encrypted with the public key, on the otehr side the message(decrypt) can only be read with the private key.
    
    * This is great not only for privacy, but also for identification since we know for sure that only the owner of the 2 keys can open the message.

## The Handshake – TLS Handshake

**How does the lock sign appears when you open a website?**

* The browser communicates with the server where the site is hosted, and they both establish a secure connection to transmit messages.

* But first they agress on how to communicate securly.

* If this negotiation is not successful, the browser lets you know by showing an error or warning.

* And if the agreement is reached, the browser display the padlock sign on the address bar.

* This process of negotiation b/w the browser and the server is called the *"the Handshake."*

**The Handshake Process:** 

1. The browser sends a list of SSL/TLS versions and a list of encryption algorithms that it can work with.
  * Nowadays, TLS 1.3 is preferred, so the browser sends a public `key-share` as well.

  * And a string of random bytes known as the "client random."

  * The list of encryption algorithms is called *cipher suite.*

2. The Server chooses TLS 1.3 and a cipher suite.
   * And returns its own public `key-share` value.
   
   * From here, TLS 1.3 encrypts the rest of the handshake and a secure connection is setup b/w the server and the browser. And a session
   
   * So, the server sends it's certifcate, including its public key so that browser can verify who the server is.
   
   * The server also sends a "server random," a random string of bytes that's generated by the server.

3. The browser checks the servers SSL certificate with the certificate authority that issued it, verifying server's identity.
   * This confirms that the server is who it says it is, and that the client is interacting with the actual owner of the domain.

   * The browser then sends a random string of bytes, the *"the premaster secret,"* which it encrypts with the server's public key and can only be decrypted by the server's private key.

4. From Server Hello (step 2) onwards the handshake is encrypted.
   * Both client and server generate session keys from the client random, the server random, and the premaster secret.
   
   * Both sends a "finished" message encrypted with the generated session keys proving that they both got the same keys.

5. Now all the data going back and forth b/w the browser & the server is secured for the rest of the session.

> *For more details read [this blog](https://www.cloudflare.com/en-gb/learning/ssl/what-happens-in-a-tls-handshake/) by Cloudflare.*

## HTTPS, SSL, TLS Differences

**HTTPS**

* HTTPS is a secure version of HTTP(HyperText Transfer Protocol).

* HTTP is the protocol used by the browser and web servers to communicate and exchange information.

* When the exchange of data is encrypted with SSL/TLS, then we call it HTTPS. 'S' -> Secure

**SSL**

* SSL -> Secure Sockets Layer. A protocol created by Netscape

* Netscape never released v1 and v2 was released with the browser Netscape 1.1 in 1995 and later v3 released fixing some major security problems.

* Netscape gave control of SSL protocol to the IETF: Internet Engineering Task Force.

* Before 1999 ended, IETF released TLS version 1.0 (Which was really SSL 3.1).

**TLS**

* So, SSL was renamed to TLS – Transport Layer Security

* `TLS 1.0(1999) –> TLS 1.1(2006) –> TLS 1.2(2008) –> TLS 1.3(2018)`
  * it's not until 2013 that browsers start to catch up and add support for TLS 1.2.
  * SSL 3.0 was officially deprecated in 2015.
  * TLS 1.3 is faster, simpler, and more secure and removes old weaker features.

* Current browsers use TLS 1.3 by default, with TLS 1.2 as a fallback for legacy clients.

**Summary**

* HTTPS is just the HTTP protocol but with data encryption using SSL/TLS.
* SSL is the original protocol (now deprecated) created at Netscape in the mid 90s.
* TLS is the new protocol for secured encryption on the web maintained by IETF.


## Certificate Authorities(CA)

A certificate authority (CA) is a third-party organization with 3 main objectives:

1. Issuing Certificates
2. Confirming the identity of the certificate owner
3. Providing proof that the certificate is valid

Example Orgs: Let's Encrypt, Symantec, Comodo, GoDaddy, DigiCert

**Which certificate should you buy?**

You have basically 3 flavors:

1. *Domain validated* – The certificate just verifies the domain name, and nothing else. You probably need this one.

2. *Organization validated* – The certificate requires the validation and manual verification of the organization behind the certificate.

3. *Extended validation* – The certificate requires an exhaustive verification of the business.

**How does certificates get validated?**

When a CA issues a certificate, they sign the certificate with their root certificate pre-installed in the root store. Most of the time it's an intermediate certificate signed with a root certificate.

* A root store is basically a database of trusted CAs.

* Apple, Windows, and Mozilla run their own root stores that they pre-install in your computer or device.

If a cat-astrophy would occur and the root certificate is compromised, it's easier to revoke the intermediate certificates, since the root certificates are installed on each device.

**Chain of Trust** – The Certificate Validation Process

1. The browser connects to a site via HTTPS and dowloads the certificate
  * It checks if it is a root cert.
  * If not, it then downloads the cert. that used to sign the certificated on the site – *intermediate certificate*.
  * If that is also not a root cert., the browser once more looks up the certificate that signed the intermediate cert.

2. If it is a root certificate, it's verified
   *  In the event that the last certificate is not a root certificate, and there are no more certificates to download, the chain is untrusted.

**Why use a certificate authority when you can self-sign your certificates?**

* A self-signed certificate provides the same level of encryption as one generated by an authority.

* And there is no charge to self-sign your certificates!
  * Almost every browser checks that the certificate is issued by a trusted authority.
  
  * As such visitors are warned that the certificate cannot be trusted.

* Self-signed certificates can be useful for testing, and intranets, but you should avoid using them on public sites.

  * Self-signed certificates can be forged. Basically, they say 'Trust me, it's me, I promise!'.
  * A trusted certificate says: 'Trust me, an authority verified me'.
